const CookInfo = [
    {
        "_initial_frame": "cook_inference/0/init.png",
        "Alice pick up the whole_onion.\nBob wait.": "cook_inference/0/5",
        "Alice pick up the hamburger_patty.\nBob wait.": "cook_inference/0/20",
        "Alice wait.\nBob pick up the burger_bottom.": "cook_inference/0/2",
        "Alice wait.\nBob pick up the black_bread_slice.": "cook_inference/0/1",
        "Alice pick up the brown_bread_slice.\nBob pick up the burger_bottom.": "cook_inference/0/17",
        "Alice pick up the lettuce.\nBob pick up the black_bread_slice.": "cook_inference/0/11",
        "Alice pick up the brown_bread_slice.\nBob pick up the pickle_slice.": "cook_inference/0/19",
        "Alice pick up the hamburger_patty.\nBob pick up the black_bread_slice.": "cook_inference/0/21",
        "Alice pick up the whole_onion.\nBob pick up the burger_bottom.": "cook_inference/0/7",
        "Alice pick up the hamburger_patty.\nBob pick up the burger_top.": "cook_inference/0/23",
        "Alice wait.\nBob wait.": "cook_inference/0/0",
        "Alice pick up the hamburger_patty.\nBob pick up the burger_bottom.": "cook_inference/0/22",
        "Alice wait.\nBob pick up the pickle_slice.": "cook_inference/0/4",
        "Alice pick up the whole_onion.\nBob pick up the black_bread_slice.": "cook_inference/0/6",
        "Alice pick up the whole_onion.\nBob pick up the burger_top.": "cook_inference/0/8",
        "Alice pick up the hamburger_patty.\nBob pick up the pickle_slice.": "cook_inference/0/24",
        "Alice pick up the lettuce.\nBob pick up the burger_bottom.": "cook_inference/0/12",
        "Alice pick up the brown_bread_slice.\nBob pick up the burger_top.": "cook_inference/0/18",
        "Alice pick up the brown_bread_slice.\nBob pick up the black_bread_slice.": "cook_inference/0/16",
        "Alice pick up the lettuce.\nBob wait.": "cook_inference/0/10",
        "Alice wait.\nBob pick up the burger_top.": "cook_inference/0/3",
        "Alice pick up the whole_onion.\nBob pick up the pickle_slice.": "cook_inference/0/9",
        "Alice pick up the lettuce.\nBob pick up the pickle_slice.": "cook_inference/0/14",
        "Alice pick up the lettuce.\nBob pick up the burger_top.": "cook_inference/0/13",
        "Alice pick up the brown_bread_slice.\nBob wait.": "cook_inference/0/15"
    },
    {
        "_initial_frame": "cook_inference/1/init.png",
        "Alice wait.\nBob cut the whole_onion.": "cook_inference/1/2",
        "Alice wait.\nBob pick up the whole_onion.": "cook_inference/1/1",
        "Alice pick up the brown_bread_slice.\nBob cut the whole_onion.": "cook_inference/1/11",
        "Alice pick up the lettuce.\nBob pick up the whole_onion.": "cook_inference/1/7",
        "Alice wait.\nBob wait.": "cook_inference/1/0",
        "Alice pick up the lettuce.\nBob wait.": "cook_inference/1/6",
        "Alice pick up the lettuce.\nBob cut the whole_onion.": "cook_inference/1/8",
        "Alice pick up the hamburger_patty.\nBob wait.": "cook_inference/1/12",
        "Alice pick up the brown_bread_slice.\nBob pick up the whole_onion.": "cook_inference/1/10",
        "Alice pick up the whole_onion.\nBob wait.": "cook_inference/1/3",
        "Alice pick up the brown_bread_slice.\nBob wait.": "cook_inference/1/9",
        "Alice pick up the hamburger_patty.\nBob cut the whole_onion.": "cook_inference/1/14",
        "Alice pick up the hamburger_patty.\nBob pick up the whole_onion.": "cook_inference/1/13",
        "Alice cut the whole_onion.\nBob wait.": "cook_inference/1/15"
    },
    {
        "_initial_frame": "cook_inference/2/init.png",
        "Alice place the burger_top onto the bottom left corner of the private region.\nBob place the onion_slice onto the top left corner of the private region.": "cook_inference/2/5",
        "Alice wait.\nBob place the onion_slice onto the plate.": "cook_inference/2/2",
        "Alice wait.\nBob place the onion_slice onto the top left corner of the private region.": "cook_inference/2/1",
        "Alice place the burger_top onto the top right corner of the private region.\nBob place the onion_slice onto the cutting board.": "cook_inference/2/11",
        "Alice place the burger_top onto the bottom left corner of the private region.\nBob place the onion_slice onto the cutting board.": "cook_inference/2/7",
        "Alice wait.\nBob wait.": "cook_inference/2/0",
        "Alice place the burger_top onto the bottom left corner of the private region.\nBob wait.": "cook_inference/2/4",
        "Alice place the burger_top onto the bottom left corner of the private region.\nBob place the onion_slice onto the plate.": "cook_inference/2/6",
        "Alice place the burger_top onto the top right corner of the private region.\nBob wait.": "cook_inference/2/8",
        "Alice place the burger_top onto the cutting board.\nBob wait.": "cook_inference/2/12",
        "Alice place the burger_top onto the top right corner of the private region.\nBob place the onion_slice onto the plate.": "cook_inference/2/10",
        "Alice wait.\nBob place the onion_slice onto the cutting board.": "cook_inference/2/3",
        "Alice place the burger_top onto the top right corner of the private region.\nBob place the onion_slice onto the top left corner of the private region.": "cook_inference/2/9",
        "Alice place the burger_top onto the cutting board.\nBob place the onion_slice onto the plate.": "cook_inference/2/14",
        "Alice place the burger_top onto the cutting board.\nBob place the onion_slice onto the top left corner of the private region.": "cook_inference/2/13",
    }
]
const GameInfo = [
    {
        "_initial_frame": "game_inference/0/init.png",
        "Alice wait.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/5",
        "Alice pick up the aqua-black piece.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/70",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie wait.\nDavid wait.": "game_inference/0/27",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid wait.": "game_inference/0/45",
        "Alice pick up the aqua-black piece.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid wait.": "game_inference/0/69",
        "Alice wait.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/20",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid wait.": "game_inference/0/36",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/28",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/2",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the red-blue piece.\nDavid wait.": "game_inference/0/78",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid wait.": "game_inference/0/72",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/47",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/52",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/1",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/57",
        "Alice pick up the aqua-black piece.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid wait.": "game_inference/0/63",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/37",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie pick up the red-blue piece.\nDavid pick up the green-black piece.": "game_inference/0/35",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid pick up the green-black piece.": "game_inference/0/17",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/59",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid wait.": "game_inference/0/42",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/11",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/49",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/32",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/73",
        "Alice wait.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/21",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/29",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie wait.\nDavid wait.": "game_inference/0/54",
        "Alice wait.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/23",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/55",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/38",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid wait.": "game_inference/0/0",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/50",
        "Alice wait.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/4",
        "Alice pick up the aqua-black piece.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/65",
        "Alice wait.\nBob wait.\nCharlie pick up the red-blue piece.\nDavid pick up the green-black piece.": "game_inference/0/8",
        "Alice wait.\nBob pick up the yellow-purple piece.\nCharlie pick up the red-blue piece.\nDavid wait.": "game_inference/0/24",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/77",
        "Alice pick up the green-brown piece.\nBob wait.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/34",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/12",
        "Alice wait.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid wait.": "game_inference/0/18",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/16",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/10",
        "Alice wait.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/3",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/79",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/48",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/43",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie pick up the green-purple piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/58",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie wait.\nDavid pick up the green-black piece.": "game_inference/0/56",
        "Alice pick up the aqua-black piece.\nBob pick up the yellow-purple piece.\nCharlie pick up the green-purple piece.\nDavid wait.": "game_inference/0/75",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie wait.\nDavid wait.": "game_inference/0/9",
        "Alice pick up the aqua-black piece.\nBob wait.\nCharlie pick up the red-blue piece.\nDavid pick up the aqua-yellow piece.": "game_inference/0/61",
        "Alice pick up the green-brown piece.\nBob pick up the yellow-purple piece.\nCharlie wait.\nDavid pick up the aqua-yellow piece.": "game_inference/0/46",
        "Alice pick up the green-brown piece.\nBob pick up the blue-brown piece.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/41",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie pick up the green-purple piece.\nDavid pick up the green-black piece.": "game_inference/0/14",
        "Alice wait.\nBob pick up the blue-brown piece.\nCharlie pick up the red-blue piece.\nDavid wait.": "game_inference/0/15"
    },
    {
        "_initial_frame": "game_inference/1/init.png",
        "Alice wait.\nBob wait.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/5",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/2",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/1",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/17",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie wait.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/11",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie wait.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/19",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/26",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid wait.": "game_inference/1/21",
        "Alice wait.\nBob wait.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/7",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/23",
        "Alice wait.\nBob wait.\nCharlie wait.\nDavid wait.": "game_inference/1/0",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/22",
        "Alice wait.\nBob wait.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/4",
        "Alice wait.\nBob wait.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/8",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid wait.": "game_inference/1/24",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid wait.": "game_inference/1/12",
        "Alice wait.\nBob place the red-blue piece onto the left border of the reachable region.\nCharlie wait.\nDavid wait.": "game_inference/1/18",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/16",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie wait.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/10",
        "Alice wait.\nBob wait.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid wait.": "game_inference/1/3",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie wait.\nDavid wait.": "game_inference/1/9",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the private region left to the puzzle box.": "game_inference/1/14",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the left border of the reachable region.\nDavid place the blue-brown piece onto the left border of the reachable region.": "game_inference/1/13",
        "Alice wait.\nBob place the red-blue piece onto the bottom right corner of the puzzle box.\nCharlie place the green-black piece onto the private region right to the puzzle box.\nDavid wait.": "game_inference/1/15"
    }
]

function get_number(info) {
    let number = 0
    for (let sub of info) {
        for (let key of Object.keys(sub)) {
            if (key.startsWith("_"))
                continue
            number++
        }
    }
    return number

}

function get_select_html(options) {
    let html = ""
    console.log(options)
    for (let option of options) {
        html += `<option value="${option}">${option}</option>`
    }
    return html
}

function get_agent_prompts(info, prefix = "") {
    let agent_prompts = []
    for (let prompt of Object.keys(info)) {
        if (prompt.startsWith("_") || !prompt.startsWith(prefix))
            continue

        prompt.split("\n").forEach((agent_prompt, i) => {
            if (agent_prompts.length <= i) {
                agent_prompts.push([])
            }
            agent_prompts[i].push(agent_prompt)
        })
    }
    for (let i = 0; i < agent_prompts.length; i++) {
        agent_prompts[i] = Array.from(new Set(agent_prompts[i])).sort().reverse()
    }
    console.log(agent_prompts[1])
    return agent_prompts
}

function cook_init() {
    const cook_init_select = $("#cook-init")
    const cook_alice_select = $("#cook-alice")
    const cook_bob_select = $("#cook-bob")
    const cook_image = $("#cook-image")
    const cook_video = $("#cook-video")
    const cook_number = $("#cook-number")
    cook_number.html(get_number(CookInfo))

    function cook_onchange(level) {
        if (level <= 0) {
            cook_init_select.html(get_select_html(Object.keys(CookInfo)))
        }
        if (level <= 1) {
            cook_image.html(`
                <img src="video/${CookInfo[cook_init_select.val()]._initial_frame}">
                <p class="caption text-center mt-2">Initial frame</p>
            `)
            let agent_prompts = get_agent_prompts(CookInfo[cook_init_select.val()])
            cook_alice_select.html(get_select_html(agent_prompts[0]))
        }
        if (level <= 2) {
            let agent_prompts = get_agent_prompts(CookInfo[cook_init_select.val()], cook_alice_select.val() + "\n")
            cook_bob_select.html(get_select_html(agent_prompts[1]))
        }
        cook_video.html(`
        <video class="centered" autoplay muted playsinline class="video-background">
            <source src="video/${CookInfo[cook_init_select.val()][`${cook_alice_select.val()}\n${cook_bob_select.val()}`]}/superres_output.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <p class="caption text-center mt-2">Generated video</p>
        `)
    }

    cook_init_select.change(() => cook_onchange(1))
    cook_alice_select.change(() => cook_onchange(2))
    cook_bob_select.change(() => cook_onchange(3))

    cook_onchange(0)
}

function game_init() {
    const game_init_select = $("#game-init")
    const game_alice_select = $("#game-alice")
    const game_bob_select = $("#game-bob")
    const game_charlie_select = $("#game-charlie")
    const game_david_select = $("#game-david")
    const game_image = $("#game-image")
    const game_video = $("#game-video")
    const game_number = $("#game-number")
    game_number.html(get_number(GameInfo))

    function game_onchange(level) {
        if (level <= 0) {
            game_init_select.html(get_select_html(Object.keys(GameInfo)))
        }
        let total_prompt = ""
        if (level <= 1) {
            game_image.html(`
                <img src="video/${GameInfo[game_init_select.val()]._initial_frame}">
                <p class="caption text-center mt-2">Initial frame</p>
            `)
            let agent_prompts = get_agent_prompts(GameInfo[game_init_select.val()])
            game_alice_select.html(get_select_html(agent_prompts[0]))
        }
        total_prompt += game_alice_select.val() + "\n"
        if (level <= 2) {
            let agent_prompts = get_agent_prompts(GameInfo[game_init_select.val()], total_prompt)
            game_bob_select.html(get_select_html(agent_prompts[1]))
        }
        total_prompt += game_bob_select.val() + "\n"
        if (level <= 3) {
            let agent_prompts = get_agent_prompts(GameInfo[game_init_select.val()], total_prompt)
            game_charlie_select.html(get_select_html(agent_prompts[2]))
        }
        total_prompt += game_charlie_select.val() + "\n"
        if (level <= 4) {
            let agent_prompts = get_agent_prompts(GameInfo[game_init_select.val()], total_prompt)
            game_david_select.html(get_select_html(agent_prompts[3]))
        }
        total_prompt += game_david_select.val()
        game_video.html(`
        <video class="centered" autoplay muted playsinline class="video-background">
            <source src="video/${GameInfo[game_init_select.val()][`${total_prompt}`]}/superres_output.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <p class="caption text-center mt-2">Generated video</p>`)
    }

    game_init_select.change(() => game_onchange(1))
    game_alice_select.change(() => game_onchange(2))
    game_bob_select.change(() => game_onchange(3))
    game_charlie_select.change(() => game_onchange(4))
    game_david_select.change(() => game_onchange(5))

    game_onchange(0)
}

$(() => {
    cook_init()
    game_init()
})